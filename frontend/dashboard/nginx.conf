server {
    listen 80;

    # Set correct MIME types for all JavaScript files including those with hash patterns
    # This is the critical part that was missing before
    default_type application/octet-stream;

    # Define MIME types
    types {
        text/html                                  html htm shtml;
        text/css                                   css;
        application/javascript                     js mjs;
        image/jpeg                                 jpeg jpg;
        image/png                                  png;
        image/gif                                  gif;
        image/svg+xml                              svg svgz;
        application/json                           json;
        application/font-woff                      woff;
        application/font-woff2                     woff2;
        application/x-font-ttf                     ttf;
        font/opentype                              otf;
        application/vnd.ms-fontobject              eot;
    }

    # Root location
    location / {
        root /usr/share/nginx/html;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # Specific handler for JS files with hash patterns
    # This explicitly sets the content type for all JS files
    location ~* \.(js|mjs)$ {
        root /usr/share/nginx/html;
        add_header Content-Type application/javascript;
        expires 1y;
        add_header Cache-Control "public, max-age=31536000, immutable";
    }

    # Handle 404s by serving the SPA
    error_page 404 =200 /index.html;
}